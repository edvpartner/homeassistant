# packages/helfer_kueche_statistiken.yaml
# Counter und Helper f√ºr K√ºchen-Statistiken

##############################################################################
# COUNTER F√úR STATISTIKEN
##############################################################################

counter:
  # K√ºhlschrank T√ºr√∂ffnungen
  kuhlschrank_tur_offnungen:
    name: K√ºhlschrank T√ºr√∂ffnungen
    icon: mdi:fridge-alert
    initial: 0
    step: 1

  # Eisw√ºrfel Entnahmen
  kuhlschrank_eiswurfel:
    name: K√ºhlschrank Eisw√ºrfel entnommen
    icon: mdi:ice-pop
    initial: 0
    step: 1

  # Crushed Ice Entnahmen
  kuhlschrank_crushed_ice:
    name: K√ºhlschrank Crushed Ice
    icon: mdi:cube
    initial: 0
    step: 1

  # Craft Ice produziert
  kuhlschrank_craft_ice_produziert:
    name: Craft Ice produziert
    icon: mdi:cube-outline
    initial: 0
    step: 1

  # Licht Automatik Heute
  kuche_licht_auto_heute:
    name: K√ºche Licht automatisch heute
    icon: mdi:lightbulb-auto
    initial: 0
    step: 1

  # Licht Manuell Heute
  kuche_licht_manuell_heute:
    name: K√ºche Licht manuell heute
    icon: mdi:lightbulb-on
    initial: 0
    step: 1

##############################################################################
# INPUT NUMBER F√úR KALTWASSER
##############################################################################

input_number:
  kuhlschrank_kaltwasser_ml:
    name: Kaltwasser entnommen (ml)
    min: 0
    max: 100000
    step: 100
    unit_of_measurement: ml
    icon: mdi:cup-water

##############################################################################
# SCRIPTS F√úR CRAFT ICE
##############################################################################

script:
  # Craft Ice 3 W√ºrfel
  kuhlschrank_craft_ice_3:
    alias: "K√ºhlschrank: Craft Ice 3 W√ºrfel"
    sequence:
      - service: select.select_option
        target:
          entity_id: select.kuhlschrank_craft_ice_anzahl
        data:
          option: "3"
      - service: notify.mobile_app
        data:
          title: "üßä Craft Ice"
          message: "Eingestellt auf 3 Eisw√ºrfel"
    mode: single

  # Craft Ice 6 W√ºrfel
  kuhlschrank_craft_ice_6:
    alias: "K√ºhlschrank: Craft Ice 6 W√ºrfel"
    sequence:
      - service: select.select_option
        target:
          entity_id: select.kuhlschrank_craft_ice_anzahl
        data:
          option: "6"
      - service: notify.mobile_app
        data:
          title: "üßä Craft Ice"
          message: "Eingestellt auf 6 Eisw√ºrfel"
    mode: single

  # Eisw√ºrfel entnommen (manuell z√§hlen)
  kuhlschrank_eiswurfel_entnommen:
    alias: "K√ºhlschrank: Eisw√ºrfel entnommen"
    sequence:
      - service: counter.increment
        target:
          entity_id: counter.kuhlschrank_eiswurfel
    mode: single

  # Crushed Ice entnommen
  kuhlschrank_crushed_ice_entnommen:
    alias: "K√ºhlschrank: Crushed Ice entnommen"
    sequence:
      - service: counter.increment
        target:
          entity_id: counter.kuhlschrank_crushed_ice
    mode: single

  # Kaltwasser entnommen (200ml)
  kuhlschrank_kaltwasser_entnommen:
    alias: "K√ºhlschrank: Kaltwasser 200ml"
    sequence:
      - service: input_number.set_value
        target:
          entity_id: input_number.kuhlschrank_kaltwasser_ml
        data:
          value: "{{ states('input_number.kuhlschrank_kaltwasser_ml') | int + 200 }}"
    mode: single

##############################################################################
# AUTOMATIONEN F√úR Z√ÑHLER
##############################################################################

automation:
  # T√ºr√∂ffnung z√§hlen
  - id: kuhlschrank_tur_counter
    alias: "K√ºhlschrank: T√ºr ge√∂ffnet Counter"
    trigger:
      - platform: state
        entity_id: binary_sensor.kuhlschrank_tur
        from: "off"
        to: "on"
    action:
      - service: counter.increment
        target:
          entity_id: counter.kuhlschrank_tur_offnungen
    mode: single

  # Licht automatisch gez√§hlt
  - id: kuche_licht_auto_counter
    alias: "K√ºche: Licht automatisch Counter"
    trigger:
      - platform: state
        entity_id: light.eg_kuchenspots
        from: "off"
        to: "on"
    condition:
      - condition: state
        entity_id: input_boolean.kuche_licht_durch_praesenz
        state: "on"
    action:
      - service: counter.increment
        target:
          entity_id: counter.kuche_licht_auto_heute
    mode: single

  # Licht manuell gez√§hlt
  - id: kuche_licht_manuell_counter
    alias: "K√ºche: Licht manuell Counter"
    trigger:
      - platform: state
        entity_id: light.eg_kuchenspots
        from: "off"
        to: "on"
    condition:
      - condition: state
        entity_id: input_boolean.kuche_licht_durch_praesenz
        state: "off"
    action:
      - service: counter.increment
        target:
          entity_id: counter.kuche_licht_manuell_heute
    mode: single

  # Counter zur√ºcksetzen um Mitternacht
  - id: kuche_counter_reset_mitternacht
    alias: "K√ºche: Counter zur√ºcksetzen um Mitternacht"
    trigger:
      - platform: time
        at: "00:00:01"
    action:
      - service: counter.reset
        target:
          entity_id:
            - counter.kuhlschrank_tur_offnungen
            - counter.kuhlschrank_eiswurfel
            - counter.kuhlschrank_crushed_ice
            - counter.kuhlschrank_craft_ice_produziert
            - counter.kuche_licht_auto_heute
            - counter.kuche_licht_manuell_heute
      - service: input_number.set_value
        target:
          entity_id: input_number.kuhlschrank_kaltwasser_ml
        data:
          value: 0
    mode: single

  # Warnung bei zu langer T√ºr√∂ffnung
  - id: kuhlschrank_tur_zu_lange_offen
    alias: "K√ºhlschrank: T√ºr zu lange offen Warnung"
    trigger:
      - platform: state
        entity_id: binary_sensor.kuhlschrank_tur
        to: "on"
        for: "00:02:00"
    action:
      - service: notify.mobile_app
        data:
          title: "‚ö†Ô∏è K√ºhlschrank"
          message: "T√ºr ist seit 2 Minuten offen!"
          data:
            priority: high
    mode: single
